@page "{id:int}"
@model WebApp.Pages.Rubrics.EditModel
@{
    ViewData["Title"] = "Edit Rubric";
}

<div class="container mt-4"><div class="row justify-content-center"><div class="col-md-8"><div class="card">
<div class="card-header"><h4><i class="fas fa-edit"></i> Edit Rubric</h4></div>
<div class="card-body">
<form id="editRubricForm"><div class="mb-3"><label class="form-label">Title</label><input id="Title" class="form-control" required /></div>
<div class="mb-3"><label class="form-label">Description</label><textarea id="Description" class="form-control"></textarea></div>
<button class="btn btn-primary">Save</button><a href="/Rubrics/Index" class="btn btn-secondary ms-2">Cancel</a></form>
<div id="alert" class="alert mt-3" style="display:none"></div>
</div></div></div></div></div>

@section Scripts {
    <script>
        const apiBaseUrl = '@Configuration["ApiSettings:BaseUrl"]';
        const id = '@Model.Id';
        async function load(){ try{ const res=await fetch(`${apiBaseUrl}/api/Rubric/${id}`); if(!res.ok) throw new Error('Failed'); const d=await res.json(); document.getElementById('Title').value=d.title||''; document.getElementById('Description').value=d.description||''; }catch(err){ showAlert(err.message||'Error','danger'); } }
        document.getElementById('editRubricForm').addEventListener('submit', async (e)=>{ e.preventDefault(); const payload={ id: parseInt(id,10), title: document.getElementById('Title').value.trim(), description: document.getElementById('Description').value.trim() }; try{ const res=await fetch(`${apiBaseUrl}/api/Rubric/${id}`, { method: 'PUT', headers: {'Content-Type':'application/json'}, body: JSON.stringify(payload) }); if(!res.ok) throw new Error('Failed'); showAlert('Saved','success'); setTimeout(()=>window.location.href='/Rubrics/Index',700); }catch(err){ showAlert(err.message||'Error saving','danger'); } });
        function showAlert(m,t){ const a=document.getElementById('alert'); a.className=`alert alert-${t} mt-3`; a.textContent=m; a.style.display='block'; setTimeout(()=>a.style.display='none',4000); }
        document.addEventListener('DOMContentLoaded', load);
    </script>
}
