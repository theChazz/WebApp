@page
@model WebApp.Pages.Rubrics.IndexModel
@{
    ViewData["Title"] = "Rubrics";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Rubrics</h2>
        <a href="/Rubrics/Create" class="btn btn-primary"><i class="fas fa-plus"></i> Create Rubric</a>
    </div>

    <div class="card"><div class="card-body"><div class="table-responsive">
        <table class="table table-striped table-hover"><thead><tr><th>ID</th><th>Title</th><th>CriteriaCount</th><th>Actions</th></tr></thead>
        <tbody id="rubricsBody"></tbody></table>
    </div></div></div>

    <div id="alert" class="alert mt-3" style="display:none"></div>
</div>

@section Scripts {
    <script>
        const apiBaseUrl = '@Configuration["ApiSettings:BaseUrl"]';
        async function loadRubrics() {
            try { const res = await fetch(`${apiBaseUrl}/api/Rubric`); if (!res.ok) throw new Error('Failed'); const items = await res.json(); document.getElementById('rubricsBody').innerHTML = items.map(i=>`<tr><td>${i.id}</td><td>${escapeHtml(i.title)}</td><td>${(i.criteria||[]).length}</td><td><a href='/Rubrics/Details/${i.id}' class='btn btn-info btn-sm'><i class='fas fa-eye'></i></a> <a href='/Rubrics/Edit/${i.id}' class='btn btn-primary btn-sm'><i class='fas fa-edit'></i></a> <button class='btn btn-danger btn-sm' onclick='deleteRubric(${i.id})'><i class='fas fa-trash'></i></button></td></tr>`).join(''); } catch (err) { showAlert(err.message||'Error','danger'); }
        }
        async function deleteRubric(id){ if(!confirm('Delete rubric?')) return; try{ const res = await fetch(`${apiBaseUrl}/api/Rubric/${id}`,{method:'DELETE'}); if(!res.ok) throw new Error('Failed'); showAlert('Deleted','success'); loadRubrics(); }catch(err){ showAlert(err.message||'Error','danger'); } }
        function showAlert(message,type){ const a=document.getElementById('alert'); a.className=`alert alert-${type} mt-3`; a.textContent=message; a.style.display='block'; setTimeout(()=>a.style.display='none',4000); }
        function escapeHtml(u){ if(!u) return ''; return u.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
        document.addEventListener('DOMContentLoaded', loadRubrics);
    </script>
}
